spring.application.name=medsafe
spring.output.ansi.enabled=ALWAYS

# ==============================================================================
# 1. DATABASE (Azure SQL con Identità Gestita)
# ==============================================================================
# La magia è qui: "Authentication=ActiveDirectoryDefault".
# Questo dice al driver: "Se sei sul PC usa il mio account, se sei su Azure usa l'Identità dell'App".
# NON servono username e password!
spring.datasource.url=jdbc:sqlserver://sql-medsafe-prod.database.windows.net:1433;database=medsafe-db;encrypt=true;trustServerCertificate=true;hostNameInCertificate=*.database.windows.net;loginTimeout=30;Authentication=ActiveDirectoryMSI;

# Hibernate Settings
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.SQLServerDialect

# ==============================================================================
# 2. AZURE BLOB STORAGE (Senza Connection String)
# ==============================================================================
# Usiamo solo l'URL. L'autenticazione la fa la libreria 'spring-cloud-azure' usando l'Identit�.
spring.cloud.azure.storage.blob.endpoint=https://medsafestorage.blob.core.windows.net/
azure.storage.container-name=upload-dir

# ==============================================================================
# 3. AZURE KEY VAULT (Opzionale ma configurato)
# ==============================================================================
spring.cloud.azure.keyvault.secret.endpoint=https://kv-medsafe-prod.vault.azure.net/

# ==============================================================================
# 4. MICROSOFT ENTRA ID (Sicurezza Token JWT)
# ==============================================================================
# Configurazione automatica di Spring Cloud Azure per validare i token
spring.cloud.azure.active-directory.enabled=true

# Usiamo nomi custom per evitare conflitti con il driver SQL
# che cercava AZURE_CLIENT_ID per la Managed Identity
spring.cloud.azure.active-directory.credential.client-id=${MEDSAFE_ENTRA_CLIENT_ID}
spring.cloud.azure.active-directory.profile.tenant-id=${MEDSAFE_ENTRA_TENANT_ID}
# spring.cloud.azure.active-directory.app-id-uri=api://${MEDSAFE_ENTRA_CLIENT_ID}

# Configurazione standard OAuth2 Resource Server per validazione JWT
# 'common' permette l'accesso a qualsiasi tenant (Multi-tenant)
spring.security.oauth2.resourceserver.jwt.issuer-uri=https://login.microsoftonline.com/common/v2.0
# spring.security.oauth2.resourceserver.jwt.jwk-set-uri=https://login.microsoftonline.com/common/discovery/v2.0/keys

# ==============================================================================
# 5. LOGGING
# ==============================================================================
logging.level.it.unisa.project.medsafe=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.com.azure=WARN

# ==============================================================================
# 6. FILE UPLOAD CONFIGURATION (Fix per immagini mediche > 1MB)
# ==============================================================================
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB
