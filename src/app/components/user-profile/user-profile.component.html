<div class="profile-container">
  <div class="profile-header">
    <h2>Il Mio Profilo</h2>
    <button *ngIf="!isEditMode && user" class="btn-edit" (click)="enableEditMode()">
      ‚úèÔ∏è Modifica Profilo
    </button>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Caricamento profilo...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="successMessage" class="success">
    <p>{{ successMessage }}</p>
  </div>

  <div *ngIf="user && !loading" class="profile-content">
    <div class="profile-card">
      <div class="profile-item">
        <label>Nome Completo</label>
        <p>{{ user.fullName }}</p>
      </div>

      <div class="profile-item">
        <label>Email</label>
        <p>{{ user.email }}</p>
      </div>

      <div class="profile-item">
        <label>Genere <span class="required">*</span></label>
        <p *ngIf="!isEditMode">{{ getGenereLabel(user.genere) }}</p>
        <select *ngIf="isEditMode" [(ngModel)]="editData.genere" class="form-select" required>
          <option value="">-- Seleziona genere --</option>
          <option *ngFor="let genere of generi" [value]="genere">
            {{ genere === 'MASCHIO' ? 'Maschio' : genere === 'FEMMINA' ? 'Femmina' : 'Non specificato' }}
          </option>
        </select>
      </div>

      <div class="profile-item">
        <label>Specializzazione <span class="required">*</span></label>
        <p *ngIf="!isEditMode">{{ formatSpecializzazione(user.specializzazione || 'Non specificata') }}</p>
        <div *ngIf="isEditMode" class="autocomplete-container">
          <input 
            type="text" 
            [(ngModel)]="editData.specializzazione" 
            (input)="filterSpecializzazioni()"
            (focus)="onSpecializzazioneFocus()"
            (blur)="onSpecializzazioneBlur()"
            placeholder="Cerca specializzazione..."
            class="form-input"
            required
          >
          <div *ngIf="showSpecializzazioniDropdown && filteredSpecializzazioni.length > 0" class="autocomplete-dropdown">
            <div 
              *ngFor="let spec of filteredSpecializzazioni" 
              class="autocomplete-item"
              (click)="selectSpecializzazione(spec)"
            >
              {{ formatSpecializzazione(spec) }}
            </div>
          </div>
          <div *ngIf="showSpecializzazioniDropdown && filteredSpecializzazioni.length === 0 && editData.specializzazione.trim() !== ''" class="autocomplete-empty">
            Nessuna specializzazione trovata
          </div>
        </div>
      </div>

      <div class="profile-item">
        <label>Data Creazione Account</label>
        <p>{{ user.createdAt | date: 'dd/MM/yyyy HH:mm' }}</p>
      </div>

      <div *ngIf="isEditMode" class="profile-actions">
        <button 
          class="btn-save" 
          (click)="saveProfile()"
          [disabled]="!isFormValid() || loading"
        >
          üíæ {{ loading ? 'Salvando...' : 'Salva' }}
        </button>
        <button class="btn-cancel" (click)="cancelEdit()" [disabled]="loading">‚ùå Annulla</button>
      </div>
    </div>
  </div>
</div>
