<div class="profile-wrapper">
  <!-- Sidebar Sinistra -->
  <aside class="profile-sidebar profile-sidebar-left">
    <div class="sidebar-card">
      <div class="sidebar-icon">ğŸ”’</div>
      <h4>Privacy</h4>
      <p>I tuoi dati sono protetti secondo il regolamento GDPR</p>
    </div>
    <div class="sidebar-card">
      <div class="sidebar-icon">ğŸ“</div>
      <h4>Certificazioni</h4>
      <p>Sistema conforme agli standard sanitari nazionali</p>
    </div>
    <div class="sidebar-card">
      <div class="sidebar-icon">ğŸ“Š</div>
      <h4>AttivitÃ </h4>
      <p>Il tuo profilo traccia le attivitÃ  di gestione referti</p>
    </div>
    <div class="sidebar-pulse">
      <svg viewBox="0 0 200 60" class="heartbeat-line">
        <polyline points="0,30 40,30 50,10 60,50 70,30 80,30 100,30 110,10 120,50 130,30 200,30" fill="none"
          stroke="#3b82f6" stroke-width="2" />
      </svg>
    </div>
  </aside>

  <!-- Contenuto Profilo -->
  <div class="profile-container">
    <!-- Decorative Header -->
    <header class="profile-hero">
      <div class="hero-bg"></div>
      <div class="hero-content">
        <div class="avatar-circle">
          <span class="avatar-emoji" *ngIf="user">{{ getGenereEmoji(user.genere) }}</span>
          <span class="avatar-emoji" *ngIf="!user">ğŸ©º</span>
        </div>
        <h1 *ngIf="user">{{ user.fullName }}</h1>
        <p *ngIf="user?.specializzazione" class="hero-spec">{{ formatSpecializzazione(user!.specializzazione!) }}</p>
        <div class="hero-actions">
          <button *ngIf="!isEditMode && user" class="btn-edit" (click)="enableEditMode()">
            âœï¸ Modifica Profilo
          </button>
        </div>
      </div>
    </header>

    <div *ngIf="user && !user.enabled" class="alert-disabled">
      âš ï¸ UTENTE DISABILITATO â€” Contattare l'amministratore per l'abilitazione.
    </div>

    <div *ngIf="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>Caricamento profilo...</p>
    </div>

    <div *ngIf="error" class="error">
      <p>{{ error }}</p>
    </div>

    <div *ngIf="successMessage" class="success">
      <p>{{ successMessage }}</p>
    </div>

    <div *ngIf="user && !loading" class="profile-content">
      <div class="profile-card">
        <div class="card-header-strip">
          <span>ğŸ‘¤</span> Informazioni Personali
        </div>

        <div class="profile-item">
          <div class="item-icon">ğŸ“›</div>
          <div class="item-content">
            <label>Nome Completo</label>
            <p>{{ user.fullName }}</p>
          </div>
        </div>

        <div class="profile-item">
          <div class="item-icon">ğŸ“§</div>
          <div class="item-content">
            <label>Email</label>
            <p>{{ user.email }}</p>
          </div>
        </div>

        <div class="profile-item">
          <div class="item-icon">âš§</div>
          <div class="item-content">
            <label>Genere <span class="required">*</span></label>
            <p *ngIf="!isEditMode">{{ getGenereLabel(user.genere) }}</p>
            <select *ngIf="isEditMode" [(ngModel)]="editData.genere" class="form-select" required>
              <option value="">-- Seleziona genere --</option>
              <option *ngFor="let genere of generi" [value]="genere">
                {{ genere === 'MASCHIO' ? 'Maschio' : genere === 'FEMMINA' ? 'Femmina' : 'Non specificato' }}
              </option>
            </select>
          </div>
        </div>

        <div class="profile-item">
          <div class="item-icon">ğŸ¥</div>
          <div class="item-content">
            <label>Specializzazione <span class="required">*</span></label>
            <p *ngIf="!isEditMode">{{ formatSpecializzazione(user.specializzazione || 'Non specificata') }}</p>
            <div *ngIf="isEditMode" class="autocomplete-container">
              <input type="text" [(ngModel)]="editData.specializzazione" (input)="filterSpecializzazioni()"
                (focus)="onSpecializzazioneFocus()" (blur)="onSpecializzazioneBlur()"
                placeholder="Cerca specializzazione..." class="form-input" required>
              <div *ngIf="showSpecializzazioniDropdown && filteredSpecializzazioni.length > 0"
                class="autocomplete-dropdown">
                <div *ngFor="let spec of filteredSpecializzazioni" class="autocomplete-item"
                  (click)="selectSpecializzazione(spec)">
                  {{ formatSpecializzazione(spec) }}
                </div>
              </div>
              <div
                *ngIf="showSpecializzazioniDropdown && filteredSpecializzazioni.length === 0 && editData.specializzazione.trim() !== ''"
                class="autocomplete-empty">
                Nessuna specializzazione trovata
              </div>
            </div>
          </div>
        </div>

        <div class="profile-item">
          <div class="item-icon">ğŸ“…</div>
          <div class="item-content">
            <label>Data Creazione Account</label>
            <p>{{ user.createdAt | date: 'dd/MM/yyyy HH:mm' }}</p>
          </div>
        </div>

        <div *ngIf="isEditMode" class="profile-actions">
          <button class="btn-save" (click)="saveProfile()" [disabled]="!isFormValid() || loading">
            ğŸ’¾ {{ loading ? 'Salvando...' : 'Salva' }}
          </button>
          <button class="btn-cancel" (click)="cancelEdit()" [disabled]="loading">âŒ Annulla</button>
        </div>
      </div>

      <!-- Decorative Footer -->
      <div class="profile-deco-footer">
        <span>ğŸ©º</span><span>ğŸ’Š</span><span>ğŸ”¬</span><span>ğŸ“‹</span><span>ğŸ¥</span>
      </div>
    </div>
  </div>

  <!-- Sidebar Destra -->
  <aside class="profile-sidebar profile-sidebar-right">
    <div class="sidebar-card">
      <div class="sidebar-icon">âœ…</div>
      <h4>Stato Account</h4>
      <p>Il tuo profilo Ã¨ attivo e verificato nel sistema MedSafe</p>
    </div>
    <div class="sidebar-card">
      <div class="sidebar-icon">ğŸŒ</div>
      <h4>Cloud Azure</h4>
      <p>Dati sincronizzati in tempo reale su infrastruttura cloud</p>
    </div>
    <div class="sidebar-card sidebar-quote">
      <div class="sidebar-icon">âš•ï¸</div>
      <h4>Galeno</h4>
      <p><em>"Il medico migliore Ã¨ anche filosofo."</em></p>
    </div>
    <div class="sidebar-pulse">
      <svg viewBox="0 0 200 60" class="heartbeat-line">
        <polyline points="0,30 40,30 50,10 60,50 70,30 80,30 100,30 110,10 120,50 130,30 200,30" fill="none"
          stroke="#10b981" stroke-width="2" />
      </svg>
    </div>
  </aside>
</div>