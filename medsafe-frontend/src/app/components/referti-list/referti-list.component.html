<div class="container">
  <h2>Lista Referti</h2>

  <div class="search-section">
    <h3>Cerca Referti</h3>
    <p class="search-hint">Compila uno o pi√π campi per filtrare i risultati</p>
    <div class="search-form">
      <div class="form-group">
        <label>Codice Fiscale:</label>
        <input type="text" [(ngModel)]="searchCodiceFiscale" placeholder="Inserisci codice fiscale" maxlength="16">
      </div>

      <div class="form-group">
        <label>Tipo Esame:</label>
        <select [(ngModel)]="searchTipoEsame">
          <option value="">Tutti</option>
          <option value="TAC">TAC</option>
          <option value="Radiografia">Radiografia</option>
          <option value="Ecografia">Ecografia</option>
          <option value="Risonanza">Risonanza Magnetica</option>
          <option value="Esami_Laboratorio">Esami di Laboratorio</option>
        </select>
      </div>
    </div>

    <div class="search-actions">
      <button class="btn-search" (click)="searchReferti()">
        üîç Cerca Referti
      </button>
      <button class="btn-reset" (click)="resetSearch()">
        ‚Üª Reset
      </button>
    </div>
  </div>

  <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
  <div class="loading" *ngIf="loading">Caricamento...</div>

  <div class="referti-grid" *ngIf="!loading && referti.length > 0">
    <div class="referto-card" [ngClass]="{'my-referto': isMyReferto(referto)}" *ngFor="let referto of referti">
      <div class="referto-header">
        <h4>{{ referto.nomePaziente }}</h4>
        <span class="badge" [ngClass]="getBadgeClass(referto.tipoEsame)">{{ formatTipoEsame(referto.tipoEsame) }}</span>
      </div>
      <p *ngIf="isMyReferto(referto)" class="my-referto-label">üë§ Tuo referto</p>
      <p><strong>CF:</strong> {{ referto.codiceFiscale }}</p>
      <p><strong>Medico:</strong> {{ referto.autoreEmail }}</p>
      <p><strong>Data:</strong> {{ referto.dataCaricamento | date:'dd/MM/yyyy HH:mm' }}</p>
      <p *ngIf="referto.testoReferto"><strong>Referto:</strong> {{ referto.testoReferto }}</p>
      <p *ngIf="referto.conclusioni"><strong>Conclusioni:</strong> {{ referto.conclusioni }}</p>

      <div class="actions">
        <button (click)="downloadPdf(referto.id!)" *ngIf="referto.urlPdfGenerato">
          Scarica Documento Referto
        </button>
        <button (click)="downloadImmagine(referto.id!)" *ngIf="referto.fileUrlImmagine">
          Scarica Esame
        </button>
      </div>
    </div>
  </div>

  <div class="no-results" *ngIf="!loading && referti.length === 0 && searched">
    Nessun referto trovato con i criteri specificati.
  </div>
</div>